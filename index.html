<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bond Valuation Calculator | CFA Institute</title>
  <meta name="description" content="Interactive bond valuation calculator demonstrating present value calculations for coupon bonds">
  
  <!-- Styles -->
  <link rel="stylesheet" href="cfa-base.css">
  <link rel="stylesheet" href="bond-specific.css">
  
  <!-- Chart.js for visualization -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- Skip Links for Accessibility -->
    <nav role="navigation" aria-label="Skip links">
      <a href="#calculator" class="skip-link">Skip to calculator</a>
      <a href="#visualizer" class="skip-link">Skip to data table</a>
    </nav>
    <main class="content">
      <!-- Card 1: Equation -->
<section id="equation-card" class="card">
  <h5 class="card-title">Bond Valuation Equation</h4>
  <p class="equation-intro">
    This dynamic equation gives the price of a coupon bond based on your input.
  </p>
  
  <!-- Dynamic equation with actual values -->
  <div class="equation-container" role="region" aria-label="Bond valuation with your values" aria-live="polite" tabindex="0" id="dynamic-equation-container">
    <div id="dynamic-mathml-equation">
      <!-- Populated by JavaScript -->
    </div>
  </div>
</section>




      <!-- Cards 2 & 3: Results and Visualizer (side by side on desktop) -->
      <div class="grid-container">
        <!-- Card 2: Results & Analysis -->
        <div class="grid-item-left">
          <section class="card" id="results-card">
            <h5 class="card-title">Results and Analysis</h4>
            <div class="card-content">
              <div id="results-content">
                <!-- Populated by JavaScript -->
              </div>
            </div>
          </section>
        </div>

        <!-- Card 3: Visualizer -->
        <div class="grid-item-right">
          <section class="card" id="visualizer" tabindex="-1">
            <h5 class="card-title">Bond Cash Flows: Annual Payment Frequency</h4>
            <div class="card-content">
              <!-- View toggle buttons -->
              <div class="view-controls">
                <div class="legend" id="chart-legend">
                  <span class="legend-item">
                    <span class="legend-color" style="background-color: var(--color-bond-purchase);"></span>
                    Present value of bond <span style="color: #b95b1d;">(PV)</span>
                  </span>
                  <span class="legend-item">
                    <span class="legend-color" style="background-color: var(--color-bond-coupon);"></span>
                    Coupon payment <span style="color: #3c6ae5;">(PMT)</span>
                  </span>
                  <span class="legend-item">
                    <span class="legend-color" style="background-color: var(--color-bond-face);"></span>
                    Principal repayment <span style="color: #0079a6;">(FV)</span>
                  </span>
                  <span class="legend-item">
                    <span class="legend-color legend-dashed-line" style="border-bottom: 2px dashed var(--color-purple-bold); background: none; width: 1.5rem; height: 0; border-left: none; border-right: none; border-top: none;"></span>
                    Yield-to-maturity <span style="color: #7a46ff;">(r)</span>
                  </span>
                </div>
                
                 <div class="button-group" role="group" aria-label="View mode - switch between chart and table">
    <button id="chart-view-btn" class="toggle-btn active" aria-pressed="true">
      Show Chart
    </button>
    <button id="table-view-btn" class="toggle-btn" aria-pressed="false">
      Show Table
    </button>
  </div>
</div>

              <!-- Screen reader announcement for view changes -->
              <div class="sr-only" aria-live="polite" aria-atomic="true" id="view-announcement"></div>

              <!-- Hidden chart description -->
<div class="sr-only" id="bond-chart-desc">
  <h5 id="bond-chart-title">Bond cash flows over time</h5>
  <p>
    This chart displays the complete cash flow timeline for a bond investment. 
    At period 0, the present value bond price (PV) is shown as a negative cash flow (money paid out). 
    Then, at each annual period, the bond pays a coupon payment (PMT) shown in blue. 
    At the final maturity date, both the last coupon payment and the principal repayment 
    (FV, shown in teal) are received. The stacked bars show how coupon and principal payments 
    combine at each period. A dashed purple line shows the yield-to-maturity rate (r) on the right axis.
    Use the arrow keys to navigate between data points and hear 
    the specific values for each period.
  </p>
</div>

             <!-- Chart container (add tabindex="-1" for programmatic focus) -->
<div id="chart-container" class="chart-wrapper" 
     role="region" 
     aria-labelledby="bond-chart-title" 
     aria-describedby="bond-chart-desc"
     tabindex="-1">  <!-- Added tabindex="-1" -->
  <canvas id="bond-chart"></canvas>
</div>

<!-- Table container (add role, aria-label, and tabindex="-1") -->
<div id="table-container" class="table-wrapper" style="display: none;"
     role="region"  
     aria-label="Bond cash flow table"  
     tabindex="-1">  <!-- Added tabindex="-1" -->
  <table id="cash-flow-table" class="data-table">  <!-- Removed tabindex="0" -->
    <!-- Populated by JavaScript -->
  </table>
  <p id="table-note" class="table-note">
    Note: Values in parentheses indicate negative cash flows (outflows).
  </p>
</div>
            </div>
          </section>
        </div>
      </div>

      <!-- Card 4: Calculator -->
      <section class="card" id="calculator" tabindex="-1">
        <h5 class="card-title">Bond Cash Flow Calculator</h4>
        <div class="card-content">
          <!-- Static info row -->
          <div class="info-box">
            <div class="info-item">
              <span class="info-label">Face value:</span>
              <span class="info-value">$100.00</span>
            </div>
            <div class="info-item">
              <span class="info-label">Payment frequency:</span>
              <span class="info-value">Annual</span>
            </div>
          </div>

          <!-- Required fields indicator -->
          

          <!-- Input controls -->
          <div class="input-section">
            <p class="sr-only" id="inputHelp">
              Enter values and the calculator updates results and the chart automatically.
            </p>

            <div class="input-group-inline">
  <div class="input-inline">
  <label for="coupon-rate" class="input-label-inline">
    Coupon rate:
  </label>
  <div class="input-with-suffix-inline">
    <input 
      type="number" 
      id="coupon-rate" 
      class="input-field-inline"
      min="0" max="10" step="0.1" value="8.6">
    <span class="input-suffix-inline">%</span>
  </div>
</div>

<div class="input-inline">
  <label for="ytm" class="input-label-inline">
    Yield-to-maturity <span style="color: #7a46ff;">(r)</span>:
  </label>
  <div class="input-with-suffix-inline">
    <input 
      type="number" 
      id="ytm" 
      class="input-field-inline"
      min="0" max="10" step="0.1" value="6.5">
    <span class="input-suffix-inline">%</span>
  </div>
</div>

<div class="input-inline">
  <label for="years" class="input-label-inline">
    Years-to-maturity <span style="color: #15803d;">(T)</span>:
  </label>
  <div class="input-with-suffix-inline">
    <input 
      type="number" 
      id="years" 
      class="input-field-inline"
      min="1" max="5" step="0.5" value="5">
    <span class="input-suffix-inline">&nbsp;</span>
  </div>
</div>


</div>


            <!-- Validation summary -->
            <div id="validation-summary" class="validation-summary" role="alert" style="display: none;">
              <div class="validation-title">Please correct the following:</div>
              <ul id="validation-list"></ul>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- JavaScript Modules -->
  <script type="module" src="calculator.js"></script>
  <script>
  // Simple MathML support check
  const supportsMathML = CSS.supports('math-style: normal');

  if (!supportsMathML) {
    // Hide MathML, show fallback
    const mathml = document.getElementById('mathml-equation');
    const fallback = document.getElementById('html-equation');
    if (mathml && fallback) {
      mathml.hidden = true;
      fallback.hidden = false;
    }
  }
</script>

</body>
</html>